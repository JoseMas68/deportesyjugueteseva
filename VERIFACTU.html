<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Módulo Verifactu - Documentación</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: #333;
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 20px;
      background: #fff;
    }
    h1 {
      color: #1a1a1a;
      font-size: 2.5em;
      margin-bottom: 10px;
      padding-bottom: 15px;
      border-bottom: 3px solid #f59e0b;
    }
    h2 {
      color: #1a1a1a;
      font-size: 1.8em;
      margin-top: 40px;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #e5e7eb;
    }
    h3 {
      color: #374151;
      font-size: 1.3em;
      margin-top: 25px;
      margin-bottom: 15px;
    }
    h4 {
      color: #4b5563;
      font-size: 1.1em;
      margin-top: 20px;
      margin-bottom: 10px;
    }
    p {
      margin-bottom: 15px;
      text-align: justify;
    }
    ul, ol {
      margin-bottom: 15px;
      padding-left: 25px;
    }
    li {
      margin-bottom: 8px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      font-size: 0.95em;
    }
    th, td {
      border: 1px solid #d1d5db;
      padding: 12px;
      text-align: left;
    }
    th {
      background: #f3f4f6;
      font-weight: 600;
      color: #374151;
    }
    tr:nth-child(even) {
      background: #f9fafb;
    }
    code {
      background: #f3f4f6;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.9em;
      color: #dc2626;
    }
    pre {
      background: #1f2937;
      color: #e5e7eb;
      padding: 20px;
      border-radius: 8px;
      overflow-x: auto;
      margin: 20px 0;
      font-size: 0.85em;
      line-height: 1.5;
    }
    pre code {
      background: none;
      color: inherit;
      padding: 0;
    }
    .warning {
      background: #fef3c7;
      border-left: 4px solid #f59e0b;
      padding: 15px 20px;
      margin: 20px 0;
      border-radius: 0 8px 8px 0;
    }
    .info {
      background: #dbeafe;
      border-left: 4px solid #3b82f6;
      padding: 15px 20px;
      margin: 20px 0;
      border-radius: 0 8px 8px 0;
    }
    .danger {
      background: #fee2e2;
      border-left: 4px solid #dc2626;
      padding: 15px 20px;
      margin: 20px 0;
      border-radius: 0 8px 8px 0;
    }
    .toc {
      background: #f9fafb;
      padding: 25px 30px;
      border-radius: 8px;
      margin: 30px 0;
    }
    .toc h3 {
      margin-top: 0;
      margin-bottom: 15px;
    }
    .toc ol {
      margin-bottom: 0;
    }
    .toc a {
      color: #2563eb;
      text-decoration: none;
    }
    .toc a:hover {
      text-decoration: underline;
    }
    .diagram {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Consolas', monospace;
      font-size: 0.85em;
      overflow-x: auto;
      margin: 20px 0;
    }
    hr {
      border: none;
      border-top: 1px solid #e5e7eb;
      margin: 40px 0;
    }
    a {
      color: #2563eb;
    }
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 0.85em;
      font-weight: 500;
    }
    .badge-yellow { background: #fef3c7; color: #92400e; }
    .badge-blue { background: #dbeafe; color: #1e40af; }
    .badge-green { background: #d1fae5; color: #065f46; }
    .badge-red { background: #fee2e2; color: #991b1b; }
    .badge-gray { background: #f3f4f6; color: #374151; }
    @media print {
      body { padding: 20px; }
      h2 { page-break-before: auto; }
      pre, table { page-break-inside: avoid; }
    }
  </style>
</head>
<body>

<h1>Módulo Verifactu</h1>
<p style="font-size: 1.2em; color: #6b7280; margin-bottom: 30px;">Sistema de Facturación Electrónica - Deportes y Juguetes Eva</p>

<div class="toc">
  <h3>Índice</h3>
  <ol>
    <li><a href="#introduccion">Introducción</a></li>
    <li><a href="#marco-legal">Marco Legal</a></li>
    <li><a href="#arquitectura">Arquitectura del Sistema</a></li>
    <li><a href="#funcionalidades">Funcionalidades</a></li>
    <li><a href="#configuracion">Configuración</a></li>
    <li><a href="#flujo">Flujo de Operación</a></li>
    <li><a href="#tipos-factura">Tipos de Factura</a></li>
    <li><a href="#seguridad">Seguridad y Certificados</a></li>
    <li><a href="#api">API Reference</a></li>
    <li><a href="#cumplimiento">Cumplimiento Normativo</a></li>
    <li><a href="#faq">Preguntas Frecuentes</a></li>
  </ol>
</div>

<hr>

<h2 id="introduccion">1. Introducción</h2>

<p>El módulo Verifactu implementa el sistema de facturación electrónica requerido por la <strong>Agencia Estatal de Administración Tributaria (AEAT)</strong> de España. Este sistema garantiza la integridad y trazabilidad de todas las facturas emitidas mediante:</p>

<ul>
  <li><strong>Encadenamiento de hashes SHA-256</strong>: Cada factura incluye el hash de la anterior, creando una cadena inmutable.</li>
  <li><strong>Códigos QR de verificación</strong>: Permiten validar cualquier factura en la web de la AEAT.</li>
  <li><strong>Comunicación en tiempo real</strong>: Envío automático o manual de registros a Hacienda.</li>
</ul>

<hr>

<h2 id="marco-legal">2. Marco Legal</h2>

<h3>Normativa Aplicable</h3>

<table>
  <thead>
    <tr>
      <th>Norma</th>
      <th>Descripción</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Ley 11/2021</strong></td>
      <td>Ley de medidas de prevención y lucha contra el fraude fiscal</td>
    </tr>
    <tr>
      <td><strong>Real Decreto 1007/2023</strong></td>
      <td>Reglamento de requisitos de los sistemas informáticos de facturación</td>
    </tr>
    <tr>
      <td><strong>Orden HFP/1398/2023</strong></td>
      <td>Especificaciones técnicas del sistema Verifactu</td>
    </tr>
  </tbody>
</table>

<h3>Plazos de Obligatoriedad</h3>

<table>
  <thead>
    <tr>
      <th>Tipo de Contribuyente</th>
      <th>Fecha Límite</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Empresas (sociedades)</td>
      <td><strong>1 de enero de 2027</strong></td>
    </tr>
    <tr>
      <td>Autónomos y profesionales</td>
      <td><strong>1 de julio de 2027</strong></td>
    </tr>
  </tbody>
</table>

<div class="danger">
  <strong>Sanciones por Incumplimiento:</strong>
  <ul style="margin-top: 10px; margin-bottom: 0;">
    <li>Multa por software no certificado: Hasta <strong>50.000€</strong></li>
    <li>Multa por registro incorrecto: Hasta <strong>10.000€</strong> por factura</li>
    <li>Responsabilidad del desarrollador: El proveedor del software puede ser sancionado</li>
  </ul>
</div>

<hr>

<h2 id="arquitectura">3. Arquitectura del Sistema</h2>

<h3>Estructura de Archivos</h3>

<pre><code>backend/src/
├── lib/verifactu/
│   ├── index.ts          # Servicio principal (orquestador)
│   ├── types.ts          # Interfaces y constantes
│   ├── hash.ts           # Generación de hash SHA-256
│   ├── xml.ts            # Generación de XML SOAP
│   ├── qr.ts             # Generación de códigos QR
│   ├── certificate.ts    # Manejo de certificados digitales
│   └── soap-client.ts    # Cliente HTTPS para AEAT
├── app/
│   ├── api/pos/verifactu/
│   │   ├── route.ts          # CRUD de registros
│   │   ├── config/route.ts   # Configuración
│   │   └── [id]/route.ts     # Detalle y acciones
│   └── admin/verifactu/
│       └── page.tsx      # Interfaz de administración
└── prisma/
    └── schema.prisma     # Modelo VerifactuRecord</code></pre>

<h3>Modelo de Datos</h3>

<pre><code>model VerifactuRecord {
  id                String   @id
  invoiceNumber     String   @unique    // Número único de factura
  invoiceDate       DateTime            // Fecha de expedición
  invoiceType       VerifactuInvoiceType // F1, F2, R1-R5

  // Emisor
  issuerNif         String              // NIF del emisor
  issuerName        String              // Razón social

  // Receptor (opcional para simplificadas)
  recipientNif      String?
  recipientName     String?

  // Importes
  baseAmount        Decimal             // Base imponible
  taxRate           Decimal             // Tipo de IVA
  taxAmount         Decimal             // Cuota de IVA
  totalAmount       Decimal             // Total factura

  // Encadenamiento (requisito legal)
  previousHash      String?             // Hash de la factura anterior
  currentHash       String              // Hash de esta factura
  hashInput         String              // Datos usados para el hash

  // Verificación
  qrContent         String              // URL de verificación AEAT

  // Estado de comunicación
  status            VerifactuStatus     // PENDING, SUBMITTED, ACCEPTED...
  aeatResponse      Json?               // Respuesta completa de AEAT
  aeatErrorCode     String?             // Código de error si rechazada
  aeatErrorMessage  String?             // Mensaje de error
  submittedAt       DateTime?           // Fecha de envío

  // XML generado
  xmlContent        String              // Documento SOAP completo
}</code></pre>

<hr>

<h2 id="funcionalidades">4. Funcionalidades</h2>

<h3>Panel de Administración</h3>

<p>El módulo se gestiona desde <code>/admin/verifactu</code> con las siguientes secciones:</p>

<h4>1. Toggle de Activación</h4>
<ul>
  <li>Permite activar/desactivar el módulo</li>
  <li>Cuando está desactivado, muestra información sobre Verifactu</li>
  <li>Al activar, despliega automáticamente la configuración</li>
</ul>

<h4>2. Configuración de Entorno</h4>
<ul>
  <li><strong>Test</strong>: Envía a servidores de prueba de AEAT (no tiene efectos legales)</li>
  <li><strong>Producción</strong>: Envía a servidores reales (registros válidos fiscalmente)</li>
</ul>

<h4>3. Datos Fiscales</h4>
<ul>
  <li>NIF/CIF de la empresa</li>
  <li>Razón social</li>
  <li>Dirección completa (calle, CP, ciudad, provincia, país)</li>
</ul>

<h4>4. Certificado Digital</h4>
<ul>
  <li>Subida de certificado .pfx o .p12</li>
  <li>Validación automática de fechas y formato</li>
  <li>Visualización de titular y periodo de validez</li>
  <li>Alertas de caducidad próxima</li>
</ul>

<h4>5. Opciones</h4>
<ul>
  <li><strong>Envío automático</strong>: Si se activa, cada venta se envía inmediatamente a AEAT</li>
  <li><strong>IVA por defecto</strong>: 21%, 10%, 4% o 0%</li>
</ul>

<h3>Estados de Registros</h3>

<p>
  <span class="badge badge-yellow">PENDING</span> Pendiente de envío
</p>
<p>
  <span class="badge badge-blue">SUBMITTED</span> Enviado a AEAT
</p>
<p>
  <span class="badge badge-green">ACCEPTED</span> Aceptado por AEAT
</p>
<p>
  <span class="badge badge-red">REJECTED</span> Rechazado por AEAT
</p>
<p>
  <span class="badge badge-gray">CANCELLED</span> Anulado
</p>

<h3>Acciones Disponibles</h3>
<ul>
  <li><strong>Enviar a AEAT</strong>: Para registros pendientes</li>
  <li><strong>Reintentar</strong>: Para registros rechazados</li>
  <li><strong>Anular</strong>: Para registros aceptados (requiere motivo)</li>
</ul>

<hr>

<h2 id="configuracion">5. Configuración</h2>

<h3>Variables de Configuración</h3>

<table>
  <thead>
    <tr>
      <th>Clave</th>
      <th>Tipo</th>
      <th>Descripción</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>verifactu_enabled</code></td>
      <td>boolean</td>
      <td>Activa/desactiva el módulo</td>
    </tr>
    <tr>
      <td><code>verifactu_environment</code></td>
      <td>'test' | 'production'</td>
      <td>Entorno de AEAT</td>
    </tr>
    <tr>
      <td><code>verifactu_auto_submit</code></td>
      <td>boolean</td>
      <td>Envío automático al crear venta</td>
    </tr>
    <tr>
      <td><code>verifactu_default_tax_rate</code></td>
      <td>number</td>
      <td>IVA por defecto (21, 10, 4, 0)</td>
    </tr>
    <tr>
      <td><code>verifactu_certificate_path</code></td>
      <td>string</td>
      <td>Ruta al certificado .pfx</td>
    </tr>
    <tr>
      <td><code>verifactu_certificate_password</code></td>
      <td>string</td>
      <td>Contraseña del certificado</td>
    </tr>
    <tr>
      <td><code>company_nif</code></td>
      <td>string</td>
      <td>NIF/CIF de la empresa</td>
    </tr>
    <tr>
      <td><code>company_legal_name</code></td>
      <td>string</td>
      <td>Razón social</td>
    </tr>
    <tr>
      <td><code>company_address</code></td>
      <td>string</td>
      <td>Dirección fiscal</td>
    </tr>
    <tr>
      <td><code>company_postal_code</code></td>
      <td>string</td>
      <td>Código postal</td>
    </tr>
    <tr>
      <td><code>company_city</code></td>
      <td>string</td>
      <td>Localidad</td>
    </tr>
    <tr>
      <td><code>company_province</code></td>
      <td>string</td>
      <td>Provincia</td>
    </tr>
    <tr>
      <td><code>company_country</code></td>
      <td>string</td>
      <td>País (código ISO: ES)</td>
    </tr>
  </tbody>
</table>

<h3>Requisitos Previos</h3>

<ol>
  <li><strong>Certificado Digital</strong>: Obtener en <a href="https://www.sede.fnmt.gob.es/certificados" target="_blank">sede.fnmt.gob.es</a></li>
  <li><strong>Datos Fiscales</strong>: Tener NIF y datos de la empresa correctos</li>
  <li><strong>Conexión a Internet</strong>: Necesaria para comunicación con AEAT</li>
</ol>

<hr>

<h2 id="flujo">6. Flujo de Operación</h2>

<h3>Creación de Registro</h3>

<div class="diagram">
┌─────────────────┐
│  Venta en TPV   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Calcular Base   │
│ + IVA + Total   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Obtener Hash    │
│ Anterior        │◄── Encadenamiento
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Generar Hash    │
│ SHA-256         │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Generar QR      │
│ Verificación    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Generar XML     │
│ SOAP            │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Guardar en BD   │
│ Status: PENDING │
└────────┬────────┘
         │
         ▼ (si auto_submit)
┌─────────────────┐
│ Enviar a AEAT   │
└─────────────────┘
</div>

<h3>Encadenamiento de Hashes</h3>

<p>El hash de cada factura se calcula con los siguientes datos:</p>

<pre><code>NIF=12345678A
&NumSerieFactura=TPV-2024-000001
&FechaExpedicionFactura=2024-01-15
&TipoFactura=F2
&CuotaTotal=21.00
&ImporteTotal=121.00
&Huella=ABC123...   ← Hash de la factura anterior
&FechaHoraHusoGenRegistro=2024-01-15T10:30:00+01:00</code></pre>

<div class="info">
  <strong>Importante:</strong> Esto crea una <strong>cadena inmutable</strong>: modificar una factura invalidaría todas las posteriores.
</div>

<h3>Comunicación con AEAT</h3>

<div class="diagram">
┌─────────────┐        HTTPS + Cert Cliente        ┌─────────────┐
│   Sistema   │ ─────────────────────────────────► │    AEAT     │
│  Verifactu  │ ◄───────────────────────────────── │  Servidores │
└─────────────┘        Respuesta SOAP              └─────────────┘
</div>

<p><strong>Endpoints AEAT:</strong></p>
<ul>
  <li><strong>Test:</strong> https://www7.aeat.es/wlpl/TIKE-CONT/ws/SuministroInformacion</li>
  <li><strong>Producción:</strong> https://www1.agenciatributaria.gob.es/wlpl/TIKE-CONT/ws/SuministroInformacion</li>
</ul>

<hr>

<h2 id="tipos-factura">7. Tipos de Factura</h2>

<h3>Facturas Ordinarias</h3>

<table>
  <thead>
    <tr>
      <th>Tipo</th>
      <th>Nombre</th>
      <th>Uso</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>F1</strong></td>
      <td>Factura completa</td>
      <td>Con todos los datos del cliente</td>
    </tr>
    <tr>
      <td><strong>F2</strong></td>
      <td>Factura simplificada</td>
      <td>Tickets sin datos del cliente (TPV)</td>
    </tr>
  </tbody>
</table>

<h3>Facturas Rectificativas</h3>

<table>
  <thead>
    <tr>
      <th>Tipo</th>
      <th>Nombre</th>
      <th>Uso</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>R1</strong></td>
      <td>Rectificativa por error en derecho</td>
      <td>Error en descripción o concepto</td>
    </tr>
    <tr>
      <td><strong>R2</strong></td>
      <td>Rectificativa por error en importe</td>
      <td>Error en cantidades o precios</td>
    </tr>
    <tr>
      <td><strong>R3</strong></td>
      <td>Rectificativa por devolución</td>
      <td>Devoluciones de productos</td>
    </tr>
    <tr>
      <td><strong>R4</strong></td>
      <td>Rectificativa por otros motivos</td>
      <td>Casos no contemplados</td>
    </tr>
    <tr>
      <td><strong>R5</strong></td>
      <td>Rectificativa simplificada</td>
      <td>Rectificativa de ticket (F2)</td>
    </tr>
  </tbody>
</table>

<div class="info">
  <strong>Nota:</strong> El TPV genera automáticamente facturas <strong>F2</strong> (simplificadas). Para facturas completas (F1) o rectificativas, se debe usar la interfaz de administración.
</div>

<hr>

<h2 id="seguridad">8. Seguridad y Certificados</h2>

<h3>Certificado Digital</h3>

<p>El sistema requiere un <strong>certificado digital cualificado</strong> para la autenticación mutua TLS con AEAT.</p>

<h4>Tipos Aceptados</h4>
<ul>
  <li>Certificado de persona jurídica (empresa)</li>
  <li>Certificado de representante</li>
  <li>Certificado de persona física (autónomos)</li>
</ul>

<h4>Obtención</h4>
<ol>
  <li>Acceder a <a href="https://www.sede.fnmt.gob.es/certificados" target="_blank">sede.fnmt.gob.es</a></li>
  <li>Solicitar certificado según tipo de contribuyente</li>
  <li>Acudir a oficina de registro para verificación de identidad</li>
  <li>Descargar certificado en formato .pfx o .p12</li>
</ol>

<h4>Almacenamiento en el Sistema</h4>
<ul>
  <li>El certificado se guarda en el servidor en <code>/certs/</code></li>
  <li>La contraseña se almacena en la base de datos</li>
  <li>Nunca se expone al cliente (navegador)</li>
</ul>

<h3>Validaciones de Seguridad</h3>

<table>
  <thead>
    <tr>
      <th>Validación</th>
      <th>Descripción</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>NIF</strong></td>
      <td>Validación de formato (persona física, NIE, CIF)</td>
    </tr>
    <tr>
      <td><strong>XML</strong></td>
      <td>Validación de estructura antes de envío</td>
    </tr>
    <tr>
      <td><strong>Certificado</strong></td>
      <td>Verificación de fechas de validez</td>
    </tr>
    <tr>
      <td><strong>Autenticación</strong></td>
      <td>Solo usuarios admin pueden acceder</td>
    </tr>
    <tr>
      <td><strong>HTTPS</strong></td>
      <td>Toda comunicación con AEAT es cifrada</td>
    </tr>
  </tbody>
</table>

<hr>

<h2 id="api">9. API Reference</h2>

<h3>GET /api/pos/verifactu</h3>
<p>Lista registros con paginación.</p>

<p><strong>Parámetros:</strong></p>
<ul>
  <li><code>page</code>: Número de página (default: 1)</li>
  <li><code>limit</code>: Registros por página (default: 20)</li>
  <li><code>status</code>: Filtrar por estado</li>
  <li><code>dateFrom</code>: Fecha inicio</li>
  <li><code>dateTo</code>: Fecha fin</li>
</ul>

<h3>POST /api/pos/verifactu</h3>
<p>Crea registro para una venta.</p>
<pre><code>{
  "saleId": "clxxx..."
}</code></pre>

<h3>GET /api/pos/verifactu/[id]</h3>
<p>Obtiene detalle completo de un registro.</p>

<h3>POST /api/pos/verifactu/[id]</h3>
<p>Ejecuta acción sobre un registro.</p>
<pre><code>{
  "action": "submit" | "cancel" | "rectify",
  "reason": "Motivo (para cancel/rectify)",
  "newAmount": 100.00  // Solo para rectify
}</code></pre>

<h3>GET /api/pos/verifactu/config</h3>
<p>Obtiene configuración actual.</p>

<h3>PUT /api/pos/verifactu/config</h3>
<p>Actualiza configuración.</p>

<h3>POST /api/pos/verifactu/config</h3>
<p>Subir certificado o ejecutar acciones (testConnection, deleteCertificate).</p>

<hr>

<h2 id="cumplimiento">10. Cumplimiento Normativo</h2>

<h3>Requisitos del RD 1007/2023 Implementados</h3>

<table>
  <thead>
    <tr>
      <th>Requisito Legal</th>
      <th>Implementación en el Sistema</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Registro inmediato</td>
      <td>Creación automática al completar venta</td>
    </tr>
    <tr>
      <td>Integridad garantizada</td>
      <td>Hash SHA-256 encadenado</td>
    </tr>
    <tr>
      <td>Trazabilidad</td>
      <td>Cadena de hashes inmutable</td>
    </tr>
    <tr>
      <td>Código QR</td>
      <td>Generado en cada factura con URL de verificación</td>
    </tr>
    <tr>
      <td>Comunicación AEAT</td>
      <td>Envío SOAP con certificado cliente</td>
    </tr>
    <tr>
      <td>Conservación</td>
      <td>Almacenamiento completo en BD</td>
    </tr>
    <tr>
      <td>No modificación</td>
      <td>Los registros aceptados no pueden editarse</td>
    </tr>
    <tr>
      <td>Facturas rectificativas</td>
      <td>Sistema completo de R1-R5</td>
    </tr>
  </tbody>
</table>

<h3>Datos Obligatorios en Cada Registro</h3>

<ul>
  <li>NIF del emisor</li>
  <li>Número de factura único</li>
  <li>Fecha de expedición</li>
  <li>Tipo de factura</li>
  <li>Base imponible</li>
  <li>Tipo impositivo</li>
  <li>Cuota tributaria</li>
  <li>Importe total</li>
  <li>Hash de la factura</li>
  <li>Hash de la factura anterior (si existe)</li>
  <li>Código QR de verificación</li>
</ul>

<h3>Verificación de Facturas</h3>

<p>Cualquier cliente puede verificar una factura:</p>
<ol>
  <li>Escanear el código QR del ticket</li>
  <li>El QR lleva a la web de verificación de AEAT</li>
  <li>AEAT muestra si la factura está registrada correctamente</li>
</ol>

<hr>

<h2 id="faq">11. Preguntas Frecuentes</h2>

<h4>¿Puedo usar el módulo en modo test indefinidamente?</h4>
<p>Sí, el modo test no tiene límites. Es recomendable usarlo hasta familiarizarse con el sistema antes de pasar a producción.</p>

<h4>¿Qué pasa si AEAT rechaza una factura?</h4>
<p>El registro queda en estado REJECTED con el código y mensaje de error. Puedes corregir el problema y reintentar el envío.</p>

<h4>¿Puedo eliminar un registro?</h4>
<p>Solo los registros en estado PENDING (no enviados) pueden eliminarse. Una vez enviados, solo pueden anularse.</p>

<h4>¿Qué certificado necesito?</h4>
<p>Un certificado digital cualificado de la FNMT o autoridad equivalente, en formato .pfx o .p12.</p>

<h4>¿Cuánto tiempo tengo para enviar una factura a AEAT?</h4>
<p>Según la normativa, el envío debe ser inmediato o en el plazo máximo de 4 días naturales. El sistema permite envío automático o manual.</p>

<hr>

<p style="text-align: center; color: #9ca3af; margin-top: 50px; font-size: 0.9em;">
  Documentación del Módulo Verifactu - Deportes y Juguetes Eva<br>
  Generado: Enero 2026
</p>

</body>
</html>
